---
title: åŸå‹é“¾å’Œnewçš„æ‰§è¡Œæµç¨‹
date: 2026-01-20
category: 'js'
---

### å¯¹è±¡åŸå‹(\_\_proto\_\_)å’ŒåŸå‹å¯¹è±¡(prototype)

JavaScriptå½“ä¸­æ¯ä¸ªå¯¹è±¡éƒ½æœ‰ä¸€ä¸ªç‰¹æ®Šçš„å†…ç½®å±æ€§ [[prototype]]ï¼Œæ¯ä¸ªå‡½æ•°éƒ½æœ‰prototype å±æ€§

`__proto__` æŒ‡å‘æ„é€ å‡½æ•°çš„`prototype`

å½“æˆ‘ä»¬é€šè¿‡å¼•ç”¨å¯¹è±¡çš„å±æ€§keyæ¥è·å–ä¸€ä¸ªvalueæ—¶ï¼Œå¯¹è±¡ä¸­æ²¡æœ‰è¯¥å±æ€§ï¼Œé‚£ä¹ˆä¼šè®¿é—®å¯¹è±¡[[prototype]]å†…ç½®å±æ€§æŒ‡å‘çš„å¯¹è±¡ä¸Šçš„å±æ€§ï¼›

![Screenshot 2026-01-20 at 2.18.31â€¯pm](assets/Screenshot%202026-01-20%20at%202.18.31%E2%80%AFpm.png)

![image-20260120152621139](assets/image-20260120152621139.png)

# new çš„æ‰§è¡Œæµç¨‹

`new` åœ¨ JavaScript ä¸­**ä¸æ˜¯è¯­æ³•ç³–**ï¼Œè€Œæ˜¯ä¸€å¥—**æ˜ç¡®ã€å›ºå®šçš„æ‰§è¡Œæµç¨‹**ã€‚

### ä¸€ã€`new` çš„æ ‡å‡†æ‰§è¡Œæ­¥éª¤

```js
const obj = new Constructor(arg1, arg2)
```

**ç­‰ä»·äºä¸‹é¢ 4 ä¸ªæ­¥éª¤ï¼š**

Step 1ï¼šåˆ›å»ºä¸€ä¸ªå…¨æ–°çš„ç©ºå¯¹è±¡

```js
const obj = {}
```

Step 2ï¼šè®¾ç½®å¯¹è±¡åŸå‹ï¼ˆå»ºç«‹åŸå‹é“¾ï¼‰

```js
obj.__proto__ = Constructor.prototype
```

> è¿™ä¸€æ­¥å†³å®šäº†ï¼š
> **å®ä¾‹å¯¹è±¡å¯ä»¥è®¿é—®æ„é€ å‡½æ•° prototype ä¸Šçš„æ–¹æ³•**

Step 3ï¼šç»‘å®š thisï¼Œæ‰§è¡Œæ„é€ å‡½æ•°

```js
Constructor.call(obj, arg1, arg2)
```

> æ­¤æ—¶ï¼š

- `this === obj`
- æ„é€ å‡½æ•°å†…éƒ¨å¯¹ `this.xxx` çš„èµ‹å€¼ï¼Œéƒ½ä¼šæŒ‚åˆ°æ–°å¯¹è±¡ä¸Š

Step 4ï¼šè¿”å›å¯¹è±¡ï¼ˆâš ï¸æœ‰è§„åˆ™ï¼‰

```js
return obj
```

**ä½†æœ‰ä¸€ä¸ªå…³é”®åˆ†æ”¯é€»è¾‘ï¼š**

| æ„é€ å‡½æ•°è¿”å›å€¼  | new çš„æœ€ç»ˆç»“æœ |
| --------------- | -------------- |
| æ²¡æœ‰ return     | è¿”å› obj       |
| return åŸºæœ¬ç±»å‹ | å¿½ç•¥ï¼Œè¿”å› obj |
| return å¯¹è±¡     | âš ï¸è¿”å›è¿™ä¸ªå¯¹è±¡ |

### äºŒã€å®Œæ•´ç­‰ä»·å®ç°ï¼ˆæ‰‹å†™ newï¼‰

```js
function myNew(Constructor, ...args) {
  // 1. åˆ›å»ºç©ºå¯¹è±¡
  const obj = {}

  // 2. è¿æ¥åŸå‹
  Object.setPrototypeOf(obj, Constructor.prototype)

  // 3. ç»‘å®š this æ‰§è¡Œæ„é€ å‡½æ•°
  const result = Constructor.apply(obj, args)

  // 4. è¿”å›è§„åˆ™
  return result instanceof Object ? result : obj
}
```

### ä¸€ä¸ªéå¸¸å…³é”®çš„é¢è¯•é™·é˜±

#### æ„é€ å‡½æ•° return å¯¹è±¡æ—¶ä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿ

```js
function Person() {
  this.name = 'Tom'
  return { age: 18 }
}

const p = new Person()

console.log(p) // { age: 18 }
console.log(p.name) // undefined
```

ğŸ‘‰ **åŸå‹é“¾ç›´æ¥æ–­æ‰**

```js
p.__proto__ !== Person.prototype // true
```
